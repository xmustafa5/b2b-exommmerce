openapi: 3.0.0
info:
  title: Lilium B2B E-commerce Backend API
  description: |
    Complete API documentation for the Lilium B2B multi-vendor platform with cash-on-delivery system.

    ## System Overview
    - **Multi-vendor B2B Platform** with company management
    - **Cash-on-Delivery** payment system
    - **Zone-based** delivery and operations
    - **Role-based** access control

    ## Authentication
    Most endpoints require JWT Bearer token authentication.
    Use the `/auth/login/dashboard` or `/auth/login/mobile` endpoints to obtain a token.

  version: 1.0.0
  contact:
    name: Lilium API Support
    email: support@lilium.iq

servers:
  - url: http://localhost:3000/api
    description: Development server
  - url: https://api.lilium.iq/api
    description: Production server

tags:
  - name: üè• Health Check
    description: API health monitoring and status checks

  - name: üîê Authentication & Authorization
    description: |
      User authentication, login systems, and token management.
      - Dashboard login for vendors and admins
      - Mobile login for shop owners
      - Password reset functionality

  - name: üë§ User Management
    description: User CRUD operations and profile management

  - name: üè¢ Company & Vendor Management
    description: |
      Multi-vendor system management including:
      - Company registration and management
      - Vendor operations and dashboard
      - Company statistics and analytics

  - name: üì¶ Product Catalog
    description: |
      Product management system including:
      - Product CRUD operations
      - Multi-language support (Arabic/English)
      - Stock management
      - Featured products

  - name: üìÅ Categories
    description: Hierarchical category system with parent-child relationships

  - name: üõí Shopping Cart
    description: |
      Multi-vendor cart system with:
      - Cart validation
      - Vendor-based grouping
      - Checkout processing

  - name: üìã Order Management
    description: |
      Complete order lifecycle management:
      - Order creation and tracking
      - Status updates
      - Order statistics

  - name: üöö Delivery & Fulfillment
    description: |
      Order delivery system including:
      - Status workflow (PENDING ‚Üí DELIVERED)
      - Driver assignment
      - Delivery tracking
      - Cash collection

  - name: üí∞ Financial Management
    description: |
      Financial operations including:
      - Settlement processing
      - Payout management
      - Commission tracking
      - Cash reconciliation

  - name: üéØ Promotions & Discounts
    description: |
      Promotional system with:
      - Percentage and fixed discounts
      - Zone-based promotions
      - Category/product targeting

  - name: üìä Analytics & Reporting
    description: |
      Business intelligence including:
      - Dashboard analytics
      - Sales reports
      - Commission reports
      - Real-time statistics

  - name: üì§ File Upload
    description: File and image upload management

  - name: üîß Internal System
    description: |
      Internal APIs for Lilium team:
      - User creation
      - System management
      - Special operations

security:
  - bearerAuth: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT token obtained from login endpoints.
        Format: `Bearer <token>`

  schemas:
    # ==================== USER SCHEMAS ====================
    User:
      type: object
      required: [name, email, phone, role]
      properties:
        id:
          type: string
          format: uuid
          example: "672c39876918009adb06fa63d"
        name:
          type: string
          example: "Ahmed Ali"
        email:
          type: string
          format: email
          example: "user@example.com"
        phone:
          type: string
          example: "+9647701234567"
        role:
          type: string
          enum: [SUPER_ADMIN, ADMIN, LOCATION_ADMIN, COMPANY_MANAGER, VENDOR, SHOP_OWNER]
          description: User role in the system
        address:
          type: string
          example: "123 Main St, Baghdad"
        zone:
          type: string
          enum: [KARKH, RUSAFA, KADHMIYA, ADHAMIYA, SADR_CITY, NEW_BAGHDAD, MANSOUR, KARRADA]
        companyId:
          type: string
          description: Associated company for vendors
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
          example: "vendor@test.com"
        password:
          type: string
          format: password
          example: "password123"

    LoginResponse:
      type: object
      properties:
        success:
          type: boolean
        user:
          $ref: '#/components/schemas/User'
        tokens:
          type: object
          properties:
            accessToken:
              type: string
              description: JWT access token
            refreshToken:
              type: string
              description: JWT refresh token

    # ==================== PRODUCT SCHEMAS ====================
    Product:
      type: object
      required: [sku, nameAr, nameEn, price, stock, categoryId]
      properties:
        id:
          type: string
          format: uuid
        sku:
          type: string
          example: "PROD-001"
        nameAr:
          type: string
          example: "ŸÖŸÜÿ™ÿ¨ ÿ™ÿ¨ÿ±Ÿäÿ®Ÿä"
        nameEn:
          type: string
          example: "Test Product"
        descriptionAr:
          type: string
        descriptionEn:
          type: string
        price:
          type: number
          format: float
          example: 25000
        compareAtPrice:
          type: number
          format: float
        cost:
          type: number
          format: float
        stock:
          type: integer
          example: 100
        minOrderQty:
          type: integer
          example: 1
        unit:
          type: string
          example: "piece"
        images:
          type: array
          items:
            type: string
            format: url
        categoryId:
          type: string
        companyId:
          type: string
        zones:
          type: array
          items:
            type: string
            enum: [KARKH, RUSAFA, KADHMIYA, ADHAMIYA, SADR_CITY, NEW_BAGHDAD, MANSOUR, KARRADA]
        isActive:
          type: boolean
          default: true
        isFeatured:
          type: boolean
          default: false

    # ==================== ORDER SCHEMAS ====================
    Order:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
        status:
          type: string
          enum: [PENDING, ACCEPTED, PREPARING, ON_THE_WAY, DELIVERED, CANCELLED, COMPLETED, REFUNDED]
          description: Current order status
        totalAmount:
          type: number
          format: float
        subtotal:
          type: number
          format: float
        deliveryFee:
          type: number
          format: float
        discount:
          type: number
          format: float
        paymentMethod:
          type: string
          enum: [CASH_ON_DELIVERY]
          default: CASH_ON_DELIVERY
        paymentStatus:
          type: string
          enum: [PENDING, PAID, FAILED]
        deliveryAddress:
          type: string
        zone:
          type: string
          enum: [KARKH, RUSAFA, KADHMIYA, ADHAMIYA, SADR_CITY, NEW_BAGHDAD, MANSOUR, KARRADA]
        notes:
          type: string
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
        createdAt:
          type: string
          format: date-time
        deliveredAt:
          type: string
          format: date-time

    OrderItem:
      type: object
      properties:
        productId:
          type: string
        productName:
          type: string
        quantity:
          type: integer
          minimum: 1
        price:
          type: number
          format: float
        subtotal:
          type: number
          format: float

    # ==================== COMPANY SCHEMAS ====================
    Company:
      type: object
      required: [name, email, phone, zones]
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        nameAr:
          type: string
        nameEn:
          type: string
        email:
          type: string
          format: email
        phone:
          type: string
        address:
          type: string
        zones:
          type: array
          items:
            type: string
            enum: [KARKH, RUSAFA, KADHMIYA, ADHAMIYA, SADR_CITY, NEW_BAGHDAD, MANSOUR, KARRADA]
        commissionRate:
          type: number
          default: 10
          description: Platform commission percentage
        minOrderAmount:
          type: number
          default: 10000
        isActive:
          type: boolean
          default: true
        logo:
          type: string
          format: url
        deliveryFees:
          type: object
          additionalProperties:
            type: number
          description: Zone-based delivery fees

    # ==================== ERROR SCHEMAS ====================
    Error:
      type: object
      properties:
        error:
          type: string
        message:
          type: string
        statusCode:
          type: integer

    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          default: true
        message:
          type: string

paths:
  # ==================================================
  # üè• HEALTH CHECK ENDPOINTS
  # ==================================================

  /health:
    get:
      tags: ['üè• Health Check']
      summary: Check API health status
      description: Returns the current health status of the API
      operationId: getHealth
      security: []
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "ok"
                  timestamp:
                    type: string
                    format: date-time
                  database:
                    type: string
                    example: "connected"

    head:
      tags: ['üè• Health Check']
      summary: Quick health check
      description: Quick health check without response body
      operationId: headHealth
      security: []
      responses:
        '200':
          description: API is healthy

  # ==================================================
  # üîê AUTHENTICATION ENDPOINTS
  # ==================================================

  /auth/login/dashboard:
    post:
      tags: ['üîê Authentication & Authorization']
      summary: Dashboard login for vendors and admins
      description: |
        Login endpoint for dashboard users:
        - VENDOR
        - COMPANY_MANAGER
        - ADMIN
        - SUPER_ADMIN
      operationId: loginDashboard
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: User doesn't have dashboard access
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/login/mobile:
    post:
      tags: ['üîê Authentication & Authorization']
      summary: Mobile login for shop owners
      description: Login endpoint for mobile app users (SHOP_OWNER role only)
      operationId: loginMobile
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: Invalid credentials
        '403':
          description: User doesn't have mobile access

  /auth/me:
    get:
      tags: ['üîê Authentication & Authorization']
      summary: Get current user profile
      description: Returns the profile of the currently authenticated user
      operationId: getCurrentUser
      responses:
        '200':
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized - Invalid or missing token

  /auth/logout:
    post:
      tags: ['üîê Authentication & Authorization']
      summary: Logout user
      description: Invalidates the current user's session
      operationId: logout
      responses:
        '200':
          description: Logged out successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /auth/refresh:
    post:
      tags: ['üîê Authentication & Authorization']
      summary: Refresh access token
      description: Use refresh token to get new access token
      operationId: refreshToken
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [refreshToken]
              properties:
                refreshToken:
                  type: string
                  description: Valid refresh token
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                  refreshToken:
                    type: string

  /auth/password/request-reset:
    post:
      tags: ['üîê Authentication & Authorization']
      summary: Request password reset
      description: Sends password reset email to the user
      operationId: requestPasswordReset
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email]
              properties:
                email:
                  type: string
                  format: email
                  example: "user@example.com"
      responses:
        '200':
          description: Reset email sent successfully

  /auth/password/reset:
    post:
      tags: ['üîê Authentication & Authorization']
      summary: Reset password with token
      description: Reset password using the token received via email
      operationId: resetPassword
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [token, newPassword]
              properties:
                token:
                  type: string
                  description: Reset token from email
                newPassword:
                  type: string
                  format: password
                  minLength: 8
      responses:
        '200':
          description: Password reset successfully

  # ==================================================
  # üë§ USER MANAGEMENT ENDPOINTS
  # ==================================================

  /users:
    get:
      tags: ['üë§ User Management']
      summary: List all users
      description: Get paginated list of users with optional filtering
      operationId: listUsers
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - name: role
          in: query
          schema:
            type: string
            enum: [SUPER_ADMIN, ADMIN, LOCATION_ADMIN, COMPANY_MANAGER, VENDOR, SHOP_OWNER]
        - name: zone
          in: query
          schema:
            type: string
            enum: [KARKH, RUSAFA, KADHMIYA, ADHAMIYA, SADR_CITY, NEW_BAGHDAD, MANSOUR, KARRADA]
        - name: search
          in: query
          schema:
            type: string
            description: Search in name, email, phone
      responses:
        '200':
          description: List of users retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  users:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
                  total:
                    type: integer
                  page:
                    type: integer
                  pages:
                    type: integer

  /users/{id}:
    get:
      tags: ['üë§ User Management']
      summary: Get user by ID
      description: Retrieve detailed information about a specific user
      operationId: getUserById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: User details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: User not found

    put:
      tags: ['üë§ User Management']
      summary: Update user
      description: Update user information
      operationId: updateUser
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                phone:
                  type: string
                address:
                  type: string
                zone:
                  type: string
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

    delete:
      tags: ['üë§ User Management']
      summary: Delete user
      description: Soft delete a user from the system
      operationId: deleteUser
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: User deleted successfully
        '404':
          description: User not found

  # ==================================================
  # üè¢ COMPANY & VENDOR ENDPOINTS
  # ==================================================

  /companies:
    get:
      tags: ['üè¢ Company & Vendor Management']
      summary: List all companies
      description: Get list of registered companies with filtering options
      operationId: listCompanies
      security: []
      parameters:
        - name: zone
          in: query
          schema:
            type: string
            enum: [KARKH, RUSAFA, KADHMIYA, ADHAMIYA, SADR_CITY, NEW_BAGHDAD, MANSOUR, KARRADA]
        - name: active
          in: query
          schema:
            type: boolean
            description: Filter by active status
      responses:
        '200':
          description: List of companies
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  companies:
                    type: array
                    items:
                      $ref: '#/components/schemas/Company'
                  total:
                    type: integer

    post:
      tags: ['üè¢ Company & Vendor Management']
      summary: Create new company
      description: Register a new company in the system (Admin only)
      operationId: createCompany
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Company'
      responses:
        '201':
          description: Company created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Company'
        '403':
          description: Forbidden - Admin access required

  /companies/{id}:
    get:
      tags: ['üè¢ Company & Vendor Management']
      summary: Get company details
      description: Retrieve detailed information about a specific company
      operationId: getCompanyById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Company details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Company'
        '404':
          description: Company not found

    put:
      tags: ['üè¢ Company & Vendor Management']
      summary: Update company
      description: Update company information
      operationId: updateCompany
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Company'
      responses:
        '200':
          description: Company updated successfully

  /companies/{id}/stats:
    get:
      tags: ['üè¢ Company & Vendor Management']
      summary: Get company statistics
      description: Retrieve statistics and analytics for a company
      operationId: getCompanyStats
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Company statistics
          content:
            application/json:
              schema:
                type: object
                properties:
                  totalProducts:
                    type: integer
                  totalOrders:
                    type: integer
                  totalRevenue:
                    type: number
                  averageOrderValue:
                    type: number

  /vendors/dashboard:
    get:
      tags: ['üè¢ Company & Vendor Management']
      summary: Get vendor dashboard
      description: Retrieve vendor dashboard statistics and summary
      operationId: getVendorDashboard
      responses:
        '200':
          description: Dashboard data
          content:
            application/json:
              schema:
                type: object
                properties:
                  todayOrders:
                    type: integer
                  pendingOrders:
                    type: integer
                  totalProducts:
                    type: integer
                  totalRevenue:
                    type: number
                  recentOrders:
                    type: array
                    items:
                      $ref: '#/components/schemas/Order'

  /vendors/products:
    get:
      tags: ['üè¢ Company & Vendor Management']
      summary: List vendor products
      description: Get all products for the authenticated vendor
      operationId: getVendorProducts
      responses:
        '200':
          description: List of vendor products
          content:
            application/json:
              schema:
                type: object
                properties:
                  products:
                    type: array
                    items:
                      $ref: '#/components/schemas/Product'

    post:
      tags: ['üè¢ Company & Vendor Management']
      summary: Create vendor product
      description: Add a new product as a vendor
      operationId: createVendorProduct
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Product'
      responses:
        '201':
          description: Product created successfully

  /vendors/orders:
    get:
      tags: ['üè¢ Company & Vendor Management']
      summary: List vendor orders
      description: Get orders for vendor's products
      operationId: getVendorOrders
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [PENDING, ACCEPTED, PREPARING, ON_THE_WAY, DELIVERED, CANCELLED]
      responses:
        '200':
          description: List of vendor orders

  # ==================================================
  # üì¶ PRODUCT CATALOG ENDPOINTS
  # ==================================================

  /products:
    get:
      tags: ['üì¶ Product Catalog']
      summary: List products with filters
      description: |
        Get paginated list of products with multiple filtering options:
        - Search by name
        - Filter by category
        - Filter by price range
        - Filter by zone availability
        - Filter by company
      operationId: listProducts
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
        - name: search
          in: query
          schema:
            type: string
            description: Search in product names and descriptions
        - name: category
          in: query
          schema:
            type: string
            description: Category ID
        - name: minPrice
          in: query
          schema:
            type: number
            description: Minimum price filter
        - name: maxPrice
          in: query
          schema:
            type: number
            description: Maximum price filter
        - name: zone
          in: query
          schema:
            type: string
            enum: [KARKH, RUSAFA, KADHMIYA, ADHAMIYA, SADR_CITY, NEW_BAGHDAD, MANSOUR, KARRADA]
        - name: companyId
          in: query
          schema:
            type: string
            description: Filter by company
        - name: inStock
          in: query
          schema:
            type: boolean
            description: Show only in-stock products
        - name: featured
          in: query
          schema:
            type: boolean
            description: Show only featured products
        - name: sortBy
          in: query
          schema:
            type: string
            enum: [price_asc, price_desc, name_asc, name_desc, created_desc]
            default: created_desc
      responses:
        '200':
          description: List of products
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  products:
                    type: array
                    items:
                      $ref: '#/components/schemas/Product'
                  total:
                    type: integer
                  page:
                    type: integer
                  pages:
                    type: integer

    post:
      tags: ['üì¶ Product Catalog']
      summary: Create new product
      description: Add a new product to the catalog
      operationId: createProduct
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Product'
      responses:
        '201':
          description: Product created successfully

  /products/{id}:
    get:
      tags: ['üì¶ Product Catalog']
      summary: Get product details
      description: Retrieve detailed information about a specific product
      operationId: getProductById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Product details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '404':
          description: Product not found

    put:
      tags: ['üì¶ Product Catalog']
      summary: Update product
      description: Update product information
      operationId: updateProduct
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Product'
      responses:
        '200':
          description: Product updated successfully

    delete:
      tags: ['üì¶ Product Catalog']
      summary: Delete product
      description: Remove product from catalog
      operationId: deleteProduct
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Product deleted successfully

  /products/featured:
    get:
      tags: ['üì¶ Product Catalog']
      summary: Get featured products
      description: Retrieve list of featured products
      operationId: getFeaturedProducts
      responses:
        '200':
          description: Featured products list

  /products/{id}/stock:
    patch:
      tags: ['üì¶ Product Catalog']
      summary: Update product stock
      description: Adjust product stock levels
      operationId: updateProductStock
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [stock]
              properties:
                stock:
                  type: integer
                  minimum: 0
                operation:
                  type: string
                  enum: [set, increment, decrement]
                  default: set
      responses:
        '200':
          description: Stock updated successfully

  # ==================================================
  # üìÅ CATEGORY ENDPOINTS
  # ==================================================

  /categories:
    get:
      tags: ['üìÅ Categories']
      summary: List all categories
      description: Get all categories, optionally as a tree structure
      operationId: listCategories
      parameters:
        - name: tree
          in: query
          schema:
            type: boolean
            default: false
            description: Return as hierarchical tree structure
      responses:
        '200':
          description: List of categories

    post:
      tags: ['üìÅ Categories']
      summary: Create category
      description: Add a new category
      operationId: createCategory
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [nameAr, nameEn]
              properties:
                nameAr:
                  type: string
                nameEn:
                  type: string
                parentId:
                  type: string
                  description: Parent category ID for subcategories
                sortOrder:
                  type: integer
      responses:
        '201':
          description: Category created successfully

  /categories/{id}:
    get:
      tags: ['üìÅ Categories']
      summary: Get category details
      operationId: getCategoryById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Category details

    put:
      tags: ['üìÅ Categories']
      summary: Update category
      operationId: updateCategory
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nameAr:
                  type: string
                nameEn:
                  type: string
                parentId:
                  type: string
                sortOrder:
                  type: integer
      responses:
        '200':
          description: Category updated

    delete:
      tags: ['üìÅ Categories']
      summary: Delete category
      operationId: deleteCategory
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: reassignTo
          in: query
          schema:
            type: string
            description: Category ID to reassign products to
      responses:
        '200':
          description: Category deleted

  # ==================================================
  # üõí SHOPPING CART ENDPOINTS
  # ==================================================

  /cart/validate:
    post:
      tags: ['üõí Shopping Cart']
      summary: Validate cart items
      description: Check stock availability and prices for cart items
      operationId: validateCart
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [items]
              properties:
                items:
                  type: array
                  items:
                    type: object
                    required: [productId, quantity]
                    properties:
                      productId:
                        type: string
                      quantity:
                        type: integer
                        minimum: 1
      responses:
        '200':
          description: Cart validation result

  /cart/summary:
    post:
      tags: ['üõí Shopping Cart']
      summary: Get cart summary
      description: Get cart summary with vendor grouping and delivery fees
      operationId: getCartSummary
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [items, userZone]
              properties:
                items:
                  type: array
                  items:
                    type: object
                userZone:
                  type: string
                  enum: [KARKH, RUSAFA, KADHMIYA, ADHAMIYA, SADR_CITY, NEW_BAGHDAD, MANSOUR, KARRADA]
      responses:
        '200':
          description: Cart summary with vendor grouping

  /cart/checkout:
    post:
      tags: ['üõí Shopping Cart']
      summary: Complete checkout
      description: Process checkout and create orders (splits by vendor automatically)
      operationId: checkout
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [items, deliveryAddress, zone]
              properties:
                items:
                  type: array
                  items:
                    type: object
                deliveryAddress:
                  type: string
                zone:
                  type: string
                  enum: [KARKH, RUSAFA, KADHMIYA, ADHAMIYA, SADR_CITY, NEW_BAGHDAD, MANSOUR, KARRADA]
                promotionCodes:
                  type: array
                  items:
                    type: string
                notes:
                  type: string
      responses:
        '201':
          description: Orders created successfully

  # ==================================================
  # üìã ORDER MANAGEMENT ENDPOINTS
  # ==================================================

  /orders:
    get:
      tags: ['üìã Order Management']
      summary: List orders
      description: Get paginated list of orders with filtering
      operationId: listOrders
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: status
          in: query
          schema:
            type: string
            enum: [PENDING, ACCEPTED, PREPARING, ON_THE_WAY, DELIVERED, CANCELLED, COMPLETED, REFUNDED]
        - name: userId
          in: query
          schema:
            type: string
        - name: fromDate
          in: query
          schema:
            type: string
            format: date
        - name: toDate
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: List of orders

    post:
      tags: ['üìã Order Management']
      summary: Create new order
      description: Place a new order
      operationId: createOrder
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [items, deliveryAddress, zone]
              properties:
                items:
                  type: array
                  items:
                    type: object
                    required: [productId, quantity]
                    properties:
                      productId:
                        type: string
                      quantity:
                        type: integer
                deliveryAddress:
                  type: string
                zone:
                  type: string
                  enum: [KARKH, RUSAFA, KADHMIYA, ADHAMIYA, SADR_CITY, NEW_BAGHDAD, MANSOUR, KARRADA]
                notes:
                  type: string
                promotionCode:
                  type: string
      responses:
        '201':
          description: Order created successfully

  /orders/{id}:
    get:
      tags: ['üìã Order Management']
      summary: Get order details
      description: Retrieve detailed information about an order
      operationId: getOrderById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Order details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'

  /orders/{id}/status:
    patch:
      tags: ['üìã Order Management']
      summary: Update order status
      description: Change order status (for admin/vendor)
      operationId: updateOrderStatus
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [status]
              properties:
                status:
                  type: string
                  enum: [ACCEPTED, PREPARING, ON_THE_WAY, DELIVERED, CANCELLED]
                notes:
                  type: string
      responses:
        '200':
          description: Status updated successfully

  /orders/{id}/cancel:
    post:
      tags: ['üìã Order Management']
      summary: Cancel order
      description: Cancel an order and restore stock
      operationId: cancelOrder
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
      responses:
        '200':
          description: Order cancelled successfully

  # ==================================================
  # üöö DELIVERY & FULFILLMENT ENDPOINTS
  # ==================================================

  /delivery/orders/{orderId}/status:
    patch:
      tags: ['üöö Delivery & Fulfillment']
      summary: Update order delivery status
      description: |
        Update order status in delivery workflow:
        - PENDING ‚Üí ACCEPTED
        - ACCEPTED ‚Üí PREPARING
        - PREPARING ‚Üí ON_THE_WAY
        - ON_THE_WAY ‚Üí DELIVERED
        - Any ‚Üí CANCELLED
      operationId: updateDeliveryStatus
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [status]
              properties:
                status:
                  type: string
                  enum: [ACCEPTED, PREPARING, ON_THE_WAY, DELIVERED, CANCELLED]
                notes:
                  type: string
                estimatedTime:
                  type: string
                  format: date-time
                location:
                  type: object
                  properties:
                    latitude:
                      type: number
                    longitude:
                      type: number
      responses:
        '200':
          description: Status updated successfully

  /delivery/orders/bulk-status:
    patch:
      tags: ['üöö Delivery & Fulfillment']
      summary: Bulk update order statuses
      description: Update multiple order statuses at once
      operationId: bulkUpdateDeliveryStatus
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [orderIds, status]
              properties:
                orderIds:
                  type: array
                  items:
                    type: string
                status:
                  type: string
                  enum: [ACCEPTED, PREPARING, ON_THE_WAY, DELIVERED, CANCELLED]
      responses:
        '200':
          description: Statuses updated successfully

  /delivery/orders/status/{status}:
    get:
      tags: ['üöö Delivery & Fulfillment']
      summary: Get orders by delivery status
      description: Retrieve all orders with a specific delivery status
      operationId: getOrdersByDeliveryStatus
      parameters:
        - name: status
          in: path
          required: true
          schema:
            type: string
            enum: [PENDING, ACCEPTED, PREPARING, ON_THE_WAY, DELIVERED, CANCELLED]
      responses:
        '200':
          description: Orders with specified status

  /delivery/orders/{orderId}/assign-driver:
    post:
      tags: ['üöö Delivery & Fulfillment']
      summary: Assign driver to order
      description: Assign a delivery driver to an order
      operationId: assignDriver
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [driverId]
              properties:
                driverId:
                  type: string
      responses:
        '200':
          description: Driver assigned successfully

  /delivery/orders/{orderId}/cash-collection:
    post:
      tags: ['üöö Delivery & Fulfillment']
      summary: Record cash collection
      description: Record cash collection for COD order upon delivery
      operationId: recordCashCollection
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [amount]
              properties:
                amount:
                  type: number
                  format: float
                  minimum: 0
                notes:
                  type: string
      responses:
        '200':
          description: Cash collection recorded

  /delivery/metrics:
    get:
      tags: ['üöö Delivery & Fulfillment']
      summary: Get delivery metrics
      description: Retrieve delivery performance metrics
      operationId: getDeliveryMetrics
      parameters:
        - name: period
          in: query
          schema:
            type: string
            enum: [today, week, month]
            default: today
        - name: companyId
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Delivery metrics
          content:
            application/json:
              schema:
                type: object
                properties:
                  totalDeliveries:
                    type: integer
                  completedDeliveries:
                    type: integer
                  pendingDeliveries:
                    type: integer
                  onTimeRate:
                    type: number
                  averageDeliveryTime:
                    type: number
                  totalCashCollected:
                    type: number
                  todayDeliveries:
                    type: integer

  /delivery/track/{orderId}:
    get:
      tags: ['üöö Delivery & Fulfillment']
      summary: Track delivery
      description: Public endpoint to track order delivery status
      operationId: trackDelivery
      security: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
        - name: phone
          in: query
          schema:
            type: string
            description: Phone number for verification
      responses:
        '200':
          description: Tracking information

  /delivery/active:
    get:
      tags: ['üöö Delivery & Fulfillment']
      summary: Get active deliveries dashboard
      description: Retrieve all active deliveries grouped by status
      operationId: getActiveDeliveries
      responses:
        '200':
          description: Active deliveries dashboard

  # ==================================================
  # üí∞ FINANCIAL MANAGEMENT ENDPOINTS
  # ==================================================

  /settlements/create:
    post:
      tags: ['üí∞ Financial Management']
      summary: Create settlement
      description: Create a new settlement for a period
      operationId: createSettlement
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [periodStart, periodEnd]
              properties:
                companyId:
                  type: string
                periodStart:
                  type: string
                  format: date-time
                periodEnd:
                  type: string
                  format: date-time
      responses:
        '201':
          description: Settlement created

  /settlements/summary:
    get:
      tags: ['üí∞ Financial Management']
      summary: Get settlement summary
      description: Retrieve settlement summary for a company
      operationId: getSettlementSummary
      parameters:
        - name: companyId
          in: query
          schema:
            type: string
        - name: startDate
          in: query
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Settlement summary

  /settlements/cash-flow:
    get:
      tags: ['üí∞ Financial Management']
      summary: Get cash flow report
      description: Retrieve cash flow report for financial analysis
      operationId: getCashFlow
      parameters:
        - name: companyId
          in: query
          schema:
            type: string
        - name: startDate
          in: query
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Cash flow report

  /payouts/request:
    post:
      tags: ['üí∞ Financial Management']
      summary: Request payout
      description: Vendor requests payout for available balance
      operationId: requestPayout
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [amount, method]
              properties:
                amount:
                  type: number
                  format: float
                  minimum: 0
                method:
                  type: string
                  enum: [BANK_TRANSFER, CASH, WALLET, CHECK]
                bankDetails:
                  type: object
                  properties:
                    accountName:
                      type: string
                    accountNumber:
                      type: string
                    bankName:
                      type: string
                notes:
                  type: string
      responses:
        '201':
          description: Payout requested

  /payouts/balance:
    get:
      tags: ['üí∞ Financial Management']
      summary: Get available balance
      description: Get available balance for payout
      operationId: getPayoutBalance
      parameters:
        - name: companyId
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Available balance
          content:
            application/json:
              schema:
                type: object
                properties:
                  balance:
                    type: number
                  currency:
                    type: string
                    default: IQD

  # ==================================================
  # üéØ PROMOTIONS & DISCOUNTS ENDPOINTS
  # ==================================================

  /promotions:
    get:
      tags: ['üéØ Promotions & Discounts']
      summary: List promotions
      description: Get list of promotions with filtering
      operationId: listPromotions
      parameters:
        - name: active
          in: query
          schema:
            type: boolean
            description: Show only active promotions
        - name: zone
          in: query
          schema:
            type: string
            enum: [KARKH, RUSAFA, KADHMIYA, ADHAMIYA, SADR_CITY, NEW_BAGHDAD, MANSOUR, KARRADA]
      responses:
        '200':
          description: List of promotions

    post:
      tags: ['üéØ Promotions & Discounts']
      summary: Create promotion
      description: Create a new promotion
      operationId: createPromotion
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [code, nameAr, nameEn, type, value]
              properties:
                code:
                  type: string
                nameAr:
                  type: string
                nameEn:
                  type: string
                type:
                  type: string
                  enum: [PERCENTAGE, FIXED_AMOUNT]
                value:
                  type: number
                maxDiscount:
                  type: number
                minPurchase:
                  type: number
                targetType:
                  type: string
                  enum: [ALL, PRODUCT, CATEGORY]
                zones:
                  type: array
                  items:
                    type: string
                startDate:
                  type: string
                  format: date-time
                endDate:
                  type: string
                  format: date-time
      responses:
        '201':
          description: Promotion created

  /promotions/validate:
    post:
      tags: ['üéØ Promotions & Discounts']
      summary: Validate promotion code
      description: Check if promotion code is valid and applicable
      operationId: validatePromotion
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [code, cartTotal, zone]
              properties:
                code:
                  type: string
                cartTotal:
                  type: number
                zone:
                  type: string
                  enum: [KARKH, RUSAFA, KADHMIYA, ADHAMIYA, SADR_CITY, NEW_BAGHDAD, MANSOUR, KARRADA]
      responses:
        '200':
          description: Promotion validation result

  # ==================================================
  # üìä ANALYTICS & REPORTING ENDPOINTS
  # ==================================================

  /analytics/dashboard/vendor:
    get:
      tags: ['üìä Analytics & Reporting']
      summary: Get vendor dashboard analytics
      description: Retrieve vendor-specific analytics and KPIs
      operationId: getVendorAnalytics
      responses:
        '200':
          description: Vendor analytics dashboard

  /analytics/dashboard/admin:
    get:
      tags: ['üìä Analytics & Reporting']
      summary: Get admin dashboard analytics
      description: Retrieve platform-wide analytics for administrators
      operationId: getAdminAnalytics
      responses:
        '200':
          description: Admin analytics dashboard

  /analytics/reports/sales:
    post:
      tags: ['üìä Analytics & Reporting']
      summary: Generate sales report
      description: Generate detailed sales report for a period
      operationId: generateSalesReport
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [startDate, endDate]
              properties:
                startDate:
                  type: string
                  format: date
                endDate:
                  type: string
                  format: date
                groupBy:
                  type: string
                  enum: [day, week, month]
                  default: day
                companyId:
                  type: string
      responses:
        '200':
          description: Sales report generated

  /analytics/realtime:
    get:
      tags: ['üìä Analytics & Reporting']
      summary: Get real-time statistics
      description: Retrieve real-time platform statistics
      operationId: getRealtimeStats
      responses:
        '200':
          description: Real-time statistics

  # ==================================================
  # üì§ FILE UPLOAD ENDPOINTS
  # ==================================================

  /upload/single:
    post:
      tags: ['üì§ File Upload']
      summary: Upload single file
      description: Upload a single file (image, document, etc.)
      operationId: uploadSingleFile
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: File uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  url:
                    type: string
                    format: url

  /upload/multiple:
    post:
      tags: ['üì§ File Upload']
      summary: Upload multiple files
      description: Upload multiple files at once
      operationId: uploadMultipleFiles
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [files]
              properties:
                files:
                  type: array
                  items:
                    type: string
                    format: binary
      responses:
        '200':
          description: Files uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  urls:
                    type: array
                    items:
                      type: string
                      format: url

  /upload/delete:
    delete:
      tags: ['üì§ File Upload']
      summary: Delete file
      description: Delete an uploaded file
      operationId: deleteFile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [url]
              properties:
                url:
                  type: string
                  format: url
      responses:
        '200':
          description: File deleted successfully

  # ==================================================
  # üîß INTERNAL SYSTEM ENDPOINTS
  # ==================================================

  /internal/login:
    post:
      tags: ['üîß Internal System']
      summary: Internal team login
      description: |
        Login endpoint for Lilium internal team.
        Credentials: lilium@lilium.iq / lilium@123
      operationId: internalLogin
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  example: lilium@lilium.iq
                password:
                  type: string
                  example: lilium@123
      responses:
        '200':
          description: Internal login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  authenticated:
                    type: boolean
                  token:
                    type: string
                  message:
                    type: string

  /internal/users/vendor:
    post:
      tags: ['üîß Internal System']
      summary: Create vendor user
      description: Internal API to create vendor users
      operationId: createVendorUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, email, password, phone, companyId]
              properties:
                name:
                  type: string
                email:
                  type: string
                  format: email
                password:
                  type: string
                phone:
                  type: string
                companyId:
                  type: string
                address:
                  type: string
                zone:
                  type: string
                  enum: [KARKH, RUSAFA, KADHMIYA, ADHAMIYA, SADR_CITY, NEW_BAGHDAD, MANSOUR, KARRADA]
      responses:
        '201':
          description: Vendor created successfully

  /internal/users/shop-owner:
    post:
      tags: ['üîß Internal System']
      summary: Create shop owner user
      description: Internal API to create shop owner users
      operationId: createShopOwnerUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, email, password, phone, shopName, address, zone]
              properties:
                name:
                  type: string
                email:
                  type: string
                  format: email
                password:
                  type: string
                phone:
                  type: string
                shopName:
                  type: string
                address:
                  type: string
                zone:
                  type: string
                  enum: [KARKH, RUSAFA, KADHMIYA, ADHAMIYA, SADR_CITY, NEW_BAGHDAD, MANSOUR, KARRADA]
      responses:
        '201':
          description: Shop owner created successfully

  /internal/users/company-manager:
    post:
      tags: ['üîß Internal System']
      summary: Create company manager
      description: Internal API to create company manager users
      operationId: createCompanyManager
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, email, password, phone, companyId]
              properties:
                name:
                  type: string
                email:
                  type: string
                  format: email
                password:
                  type: string
                phone:
                  type: string
                companyId:
                  type: string
      responses:
        '201':
          description: Company manager created successfully